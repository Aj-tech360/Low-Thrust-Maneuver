% Given spacecraft/orbit data
r0 = 6698e3;
v = 500e-5;
rGSO = 35786e3;
t0 = 0;
tBurn = 10e6; % 2 days => s
vOrbit0 = sqrt(muEarth/r0);

% Graviational accleration function 
g = @(r) g0*(r0/r)^2;

% ODE initial conditions
IC = [1;0;1;0]; %rho0 A0 B0 theta0
nPts = 50000;
tSpan = linspace(t0,tBurn,nPts);

opts = odeset('Events',@(t,y) ltmOdeEventHandler(t,y,r0,rGSO));
[t,y] = ode45(@(t,y) ltmOdeSolver(t,y,r0,v),tSpan,IC) % y = [rho; A; B; theta]
% transferTime = te/86400; % time to reach orbit in days

% Calculate delta V 


% Plot orbit transfer
figure;
theta = linspace(0,2*pi);
xInt = r0*cos(theta);
yInt = r0*sin(theta);
xFinal = rGSO*cos(theta);
yFinal = rGSO*sin(theta);
xTransfer = r0*y(:,1).*cos(y(:,4));
yTransfer = r0*y(:,1).*sin(y(:,4));
plot(xInt/1e3,yInt/1e3,'g',xFinal/1e3,yFinal/1e3,'r');
hold on;
plot(xTransfer/1e3,yTransfer/1e3,'k');
grid on;
axis equal;
title('LTM Transfer from LEO to GSO');
xlabel('x [km]');
ylabel('y [km]');
